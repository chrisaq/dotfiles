#!/usr/bin/env bash
#:usage: cq_hypr_next-on-output
#:no-args: true
#:desc: Switch to next workspace on the current monitor.
set -euo pipefail
mon=$(hyprctl -j activeworkspace | jq -r '.monitor')
cur=$(hyprctl -j activeworkspace | jq -r '.id')
mapfile -t ws < <(hyprctl -j workspaces | jq -r --arg m "$mon" '
  map(select(.monitor==$m)) | map(.id) | unique | sort | .[]')
for i in "${!ws[@]}"; do
  if [[ "${ws[$i]}" == "$cur" ]]; then
    nxt=${ws[$(((i+1)%${#ws[@]}))]}
    hyprctl dispatch workspace "$nxt"
    exit 0
  fi
done
